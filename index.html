<!DOCTYPE HTML>
<!--
	Spatial by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
<head>
	<title>Spatial by TEMPLATED</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->
	<script src="js/jquery.min.js"></script>
	<script src="js/skel.min.js"></script>
	<script src="js/skel-layers.min.js"></script>
	<script src="js/init.js"></script>
	<noscript>
		<link rel="stylesheet" href="css/skel.css" />
		<link rel="stylesheet" href="css/style.css" />
		<link rel="stylesheet" href="css/style-xlarge.css" />
	</noscript>
</head>
<body class="landing">

<!-- Header -->
<header id="header" class="alt">
	<nav id="nav">
		<ul>
			<li><a href="index.html">BikeShare</a></li>
			<li><a href="generic.html">IndyGo</a></li>
			<li><a href="elements.html">Payment</a></li>
		</ul>
	</nav>
</header>


<!-- One -->
<section id="one" class="wrapper style1">
	<div>
		<div style="height: 100em; width: 100em" class="row 200%" id="test">
		</div>
	</div>
</section>


<script>
    // Note: This example requires that you consent to location sharing when
    // prompted by your browser. If you see the error "The Geolocation service
    // failed.", it means you probably did not give permission for the browser to
    // locate you.
    function initMap() {
        //getBikeStations();
        var map = new google.maps.Map(document.getElementById('test'), {
            center: {lat: 39.76593, lng: -86.16216},
            zoom: 15
        });
        var stats = getBikeStations(map);
        //console.log(stats);
        var infoWindow = new google.maps.InfoWindow({map: map});
        // var myLatLng = {lat: 39.765, lng: -86.162};
        // var marker = new google.maps.Marker({
        //    position: myLatLng,
        //    map: map,
        //    title: 'Hello World!'
        //  });
        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                infoWindow.setPosition(pos);
                infoWindow.setContent('Location found.');
                map.setCenter(pos);
            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }
    }
    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
    }
    function getBikeStations(map) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open('GET', 'https://gbfs.bcycle.com/bcycle_pacersbikeshare/station_information.json', true);
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4) {
                if(xmlhttp.status == 200) {
                    var obj = JSON.parse(xmlhttp.responseText);
                    //  console.log(obj.data);
                    createBikePins(map, obj.data);
                    return obj.data;
                }
            }
        };
        xmlhttp.send(null);
    }
    function createBikePins(map, stations) {
        //console.log(JSON.stringify(stations));
        var contentString="";

        var infowindow;
        infowindow = new google.maps.InfoWindow({
            content: "holding..."
        });

        for (i = 0; i < 27; i++) {


            var myLatLng = {lat: stations.stations[i].lat, lng: stations.stations[i].lon};
            var marker = new google.maps.Marker({
                position: myLatLng,
                map: map,
                title: stations.stations[i].name
            });

						google.maps.event.addListener(marker, 'click', function () {
						   // do something with this marker ...
							 console.log(this.getTitle());
							 contentString =
	                 '<div id="content">'+
	                 '<div id="siteNotice">'+'</div>'+
	                 '<h1 id="firstHeading" class="firstHeading">'+i+' '+this.getTitle()+'</h1>'+
	                 '<div id="bodyContent">'+
	                 '<p><b>'+this.getTitle()+'</b>'
	             '</div>'+
	             '</div>';
							 infowindow.setContent(contentString);
							 infowindow.open(map, this);
						});

        }
    }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLQhYCMXm-mF8RcIVuwt0RMB3XaOqGXWM&callback=initMap">
</script>
</body>
</html>
